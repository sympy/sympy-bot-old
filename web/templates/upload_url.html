{% extends "base.html" %}

{% block title %}
Generate new URL-path for Github API
{% endblock %}

{% block runtime %}
$(document).ready(function() {
    $('#url_changes').dataTable({
        "sScrollY": "400px",
        "bPaginate": false,
        "aaSorting": [[ 0, "desc" ]]
    });
});
{% endblock %}

{% block content %}
<form action="/upload_pull/" method="get">
<h2>Administrator's access required</h2>
{% if user %}
    {%if is_admin %}
        <b>Upload URL:</b>
        <p>
        {% if upload_url %}
            <a href="/upload_pull/{{ upload_url }}">{{ upload_url }}</a>
        {% else %}
            There is no upload URL yet, press "Generate" to create new
        {% endif %}
        </p>
        <b>NOTE:</b>
        <p>
        If you will press button below, then review site will generate new URL
        for uploading pull request information and will send an email with new URL
        to all admins.
        </p>
        <input type="submit" name="generate" value="Generate">
        <input type="submit" name="populate" value="Populate">
        <table id="url_changes" class="display">
            <thead>
                <tr>
                    <th>URL-path</th>
                    <th>Generated by</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                    <tr>
                        <td>{{ row.url_path }}</a></td>
                        <td>{{ row.user }}</td>
                        <td>{{ row.created_at|date:"r" }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

    {% else %}
        Your account <b>{{ user.nickname }}</b> has no rights to access this page
        <br />
        Maybe <a href="{{ logout_url }}">logout</a> and try again?
    {% endif %}
{% else %}
    <a href="{{ login_url }}">Sign in</a>.
{% endif %}
</form>
{% endblock %}
